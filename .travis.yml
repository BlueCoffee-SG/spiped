language: c
sudo: false
dist: trusty
matrix:
  include:
    - os: linux
      compiler: clang
      env: CFLAGS="-std=c99 -O2 -Wall -Wextra -Werror -Weverything -Wno-#warnings -Wno-pedantic -Wno-padded -Wno-format-nonliteral -Wno-disabled-macro-expansion -Wno-missing-noreturn -Wno-reserved-id-macro -Wno-cast-align"
    - os: linux
      compiler: gcc
      env: CFLAGS="-std=c99 -O2 -Wall -Wextra -Werror -Wpedantic -pedantic-errors -Wno-clobbered"
    - os: osx
      compiler: clang
      env: CFLAGS="-std=c99 -O2 -Wall -Wextra -Werror -Weverything -Wno-#warnings -Wno-pedantic -Wno-padded -Wno-format-nonliteral -Wno-disabled-macro-expansion -Wno-missing-noreturn -Wno-reserved-id-macro"
env:
  global:
    - secure: "TM30hoegVhKk0UE8RDFVbZ9Q29Z/ewceU19DsJf9ifiBXDl6OVnxujrMYwW/ltdRYIuhvvkJ2K94hN21pNNdUuExEXWtdSUQlEi8OWSDQBPaStwsM39xLoqUusCBEs7VLoSluhTBzn7CbnbWiqod5ZITGpDOqqvpBwuHAHdrURI0Rb8oPi2DnmzW8r8p2F+xIN/Y4iaRTpdCSthagyJDbE5ZXxPQCfDK1Yi4hYnIRUxJN3K6hMGZOOgCZLgWVL0njHU8OUp3GKiYwqnJOnd6RZTyfB4GFKnmYKr6Uwx+loH+g0da5jFiQdL47yxa1I1zPyOv2gDgmLcSpPRnFcf+gJwfGqvI4Z1VFU0T22x57aCHc9zW/29VvQWBDtO3ObFxPLxKLU5sXEj85HuJKxVvAn+jFcgao4cyqe+Y6YqBiXi/Yexi/QXsr2z0vKoESibBqdG9WEoNmuGDgQQnZYK1aOIIdceSMrAzBe6LuJMqNi5Lit9IxLWUNxyoNPjwclMg08iJeB6i7erfQpPUEAH6uHHF/RSdLR6eFATmV4ixCKibHnN0EgNcI2CDFjetviAwAnY88E+5F8GukZqZUT2iVwsxu6iFOxgNf3e5vFToXVHIw54NSkVWI++MvuFJ9r5jLnIImq5bLwnT0JObm/nEVJo0T2pIXGJ2Zf7Jo6DqGbc="
    - TEST_DNSTHREAD_ENABLE_REMOTE=1

addons:
  coverity_scan:
    project:
      name: "Tarsnap/spiped"
      description: "Build submitted via Travis CI"
    notification_email: cperciva@tarsnap.com
    build_command_prepend: ""
    build_command: "make all clean"
    branch_pattern: coverity-scan

before_install:
- test $TRAVIS_BRANCH != coverity-scan -o ${TRAVIS_JOB_NUMBER##*.} = 1 || exit 0
- 'if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then export CFLAGS="-I/usr/local/opt/openssl/include $CFLAGS" LDFLAGS="-L/usr/local/opt/openssl/lib $LDFLAGS"; fi'
script:
- test $TRAVIS_BRANCH != coverity-scan || exit 0
- make && make test
